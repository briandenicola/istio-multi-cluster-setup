---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: istio-csr
  namespace: cert-manager
spec:
  interval: 5m
  chart:
    spec:
      chart: cert-manager-istio-csr
      version: 'v0.4.0'
      sourceRef:
        kind: HelmRepository
        name: jetstack
        namespace: flux-system
      interval: 1m
  values:
    app:
      tls:
        rootCAFile: "/var/run/secrets/istio-csr/ca.crt"
      certmanager:
        issuer:
          name: "vault-issuer"
    volumeMounts:
    - name: "root-ca"
      mountPath: "/var/run/secrets/istio-csr"
      readOnly: true
    volumes:
    - name: "root-ca"
      secret:
        secretName: "istio-intermediate-ca"